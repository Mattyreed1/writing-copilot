<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <?!= include('ui/CSS'); ?>
  </head>
  <body>
    <div id="sidebar-content">
      <h1>Writing Copilot</h1>
      
      <div id="writer-style-section">
        <h2>Writer Styles</h2>
        <select id="writer-style-select" multiple="multiple">
        </select>
      </div>

      <div id="writing-style-section">
        <h2>Writing Styles</h2>
        <select id="writing-style-select" multiple="multiple">
        </select>
      </div>

      <div id="ai-suggestions-section">
        <h2>AI Suggestions</h2>
        <div class="button-container">
          <button id="edit-btn">Edit</button>
          <button id="rewrite-btn">Rewrite</button>
          <button id="continue-btn">Continue</button>
        </div>
        <div id="ai-result"></div>
      </div>

      <div id="citations-section">
        <h2>Citations</h2>
        <button id="find-citations">Find Citations</button>
        <div id="citations-output"></div>
      </div>
    </div>

    <script>
      $(function() {
        console.log('Sidebar loaded');
        
        // Load writer styles
        google.script.run.withSuccessHandler(function(styles) {
          var select = $('#writer-style-select');
          styles.forEach(function(style) {
            select.append($('<option></option>').val(style).text(style));
          });
          select.select2();
        }).getWriterStyles();

        // Load writing styles
        google.script.run.withSuccessHandler(function(styles) {
          var select = $('#writing-style-select');
          styles.forEach(function(style) {
            select.append($('<option></option>').val(style).text(style));
          });
          select.select2();
        }).getWritingStyles();

        // Get suggestions button click handler
        $('#get-suggestions').click(function() {
          var selectedWriters = $('#writer-style-select').val();
          var selectedStyles = $('#writing-style-select').val();
          
          if (!selectedWriters.length || !selectedStyles.length) {
            alert('Please select at least one writer style and one writing style.');
            return;
          }
          
          google.script.run.withSuccessHandler(function(suggestion) {
            $('#suggestions-output').text(suggestion);
          }).getSuggestion(selectedWriters, selectedStyles);
        });

        // Find citations button click handler
        $('#find-citations').click(function() {
          google.script.run.withSuccessHandler(function(citations) {
            var citationsHtml = citations.map(function(citation) {
              return '<p>' + citation.title + ' by ' + citation.author + ' (' + citation.year + ')</p>';
            }).join('');
            $('#citations-output').html(citationsHtml);
          }).findCitations();
        });
      });
    </script>
  </body>
</html>

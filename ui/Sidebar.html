<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <?!= include('ui/CSS'); ?>
  </head>
  <body>
    <div class="sidebar branding-below">
      <div class="card" id="main-card">
        <div class="block form-group">
          <label for="selected-text"><b>Selected Text</b></label>
          <textarea class="width-100" id="selected-text" rows="4" readonly></textarea>
        </div>
        
        <div class="block" id="action-buttons">
          <button class="action" data-action="edit">Edit</button>
          <button class="action" data-action="rewrite">Rewrite</button>
          <button class="action" data-action="continue">Continue</button>
        </div>
      </div>

      <div id="results-container"></div>

      <div class="block" id="error-message" style="display:none;">
        <div class="error">An error occurred. Please try again.</div>
      </div>
    </div>

    <div class="sidebar bottom">
      <img alt="Add-on logo" class="logo" src="https://www.gstatic.com/images/branding/product/1x/translate_48dp.png" width="27" height="27">
      <span class="gray branding-text">Writing Copilot by YourCompany</span>
    </div>

    <script>
      function onSidebarLoad() {
        google.script.run.withSuccessHandler(updateSelectedText).getSelectedText();
      }

      function runAction(action) {
        var text = document.getElementById('selected-text').value;
        google.script.run.withSuccessHandler(updateResults)
          .withFailureHandler(showError)
          [action](text);
      }

      function updateResults(result) {
        document.getElementById('results-container').innerHTML = result;
      }

      function updateSelectedText(text) {
        document.getElementById('selected-text').value = text;
      }

      function showError(error) {
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-message').innerText = error.message;
      }

      // Initialize the sidebar
      google.script.run.withSuccessHandler(onSidebarLoad).getSelectedText();

      // Add event listeners to buttons
      document.querySelectorAll('.action').forEach(function(button) {
        button.addEventListener('click', function() {
          runAction(this.dataset.action);
        });
      });
    </script>
  </body>
</html>

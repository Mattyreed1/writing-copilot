<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <?!= include('ui/CSS'); ?>
    <?!= include('components/ResultsContainer'); ?>
    <?!= include('components/EditResults'); ?>
    <?!= include('components/RewriteResults'); ?>
    <?!= include('components/ContinuationResults'); ?>
    <?!= include('components/QuoteResults'); ?>
    <?!= include('components/ResourceResults'); ?>
  </head>
  <body>
    <div class="sidebar branding-below">
      <div class="card" id="main-card">
        <div class="block form-group">
          <label for="selected-text"><b>Selected Text</b></label>
          <textarea class="width-100" id="selected-text" rows="4" readonly></textarea>
        </div>
        
        <div class="block" id="action-buttons">
          <button class="action" data-action="edit">Edit</button>
          <button class="action" data-action="rewrite">Rewrite</button>
          <button class="action" data-action="continue">Continue</button>
        </div>
      </div>

      <div id="results-container"></div>

      <div class="block" id="error-message" style="display:none;">
        <div class="error">An error occurred. Please try again.</div>
      </div>
    </div>

    <div class="sidebar bottom">
      <img alt="Add-on logo" class="logo" src="https://www.gstatic.com/images/branding/product/1x/translate_48dp.png" width="27" height="27">
      <span class="gray branding-text">Writing Copilot by YourCompany</span>
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <?!= include('components/ResultsContainer'); ?>
    <?!= include('components/ContinuationResults'); ?>
    <?!= include('components/RewriteResults'); ?>
    <script>
      $(function() {
        $('.action').click(function() {
          runAction($(this).data('action'));
        });
        
        google.script.run.withSuccessHandler(updateSelectedText)
          .withFailureHandler(showError)
          .getSelectedText();
      });

      function updateSelectedText(text) {
        $('#selected-text').val(text);
      }

      function runAction(action) {
        $('#error-message').hide();
        $('#main-card').hide();
        showResultsContainer(action);
        
        google.script.run.withSuccessHandler(function(results) {
          displayResults(action, results);
        })
          .withFailureHandler(showError)
          [`generate${action.charAt(0).toUpperCase() + action.slice(1)}`]($('#selected-text').val());
      }

      function showError(msg) {
        $('#error-message').text(msg).show();
      }
    </script>
  </body>
</html>

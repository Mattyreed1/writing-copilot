<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <style>
      /* Add your custom styles here */
    </style>
  </head>
  <body>
    <div id="app">
      <!-- The app content will be dynamically inserted here -->
    </div>
    
    <script>
      function onSidebarLoad() {
        google.script.run.withSuccessHandler(showCard).createHomepageCard();
      }

      function showCard(card) {
        const app = document.getElementById('app');
        app.innerHTML = ''; // Clear existing content
        
        // Render the card
        const cardElement = renderCard(card);
        app.appendChild(cardElement);
      }

      function renderCard(card) {
        const cardElement = document.createElement('div');
        cardElement.className = 'card';

        // Render header
        if (card.header) {
          const header = document.createElement('div');
          header.className = 'card-header';
          header.textContent = card.header.title;
          cardElement.appendChild(header);
        }

        // Render sections
        card.sections.forEach(section => {
          const sectionElement = document.createElement('div');
          sectionElement.className = 'card-section';

          if (section.header) {
            const sectionHeader = document.createElement('h2');
            sectionHeader.textContent = section.header;
            sectionElement.appendChild(sectionHeader);
          }

          section.widgets.forEach(widget => {
            const widgetElement = renderWidget(widget);
            sectionElement.appendChild(widgetElement);
          });

          cardElement.appendChild(sectionElement);
        });

        return cardElement;
      }

      function renderWidget(widget) {
        switch (widget.type) {
          case 'TextParagraph':
            const p = document.createElement('p');
            p.textContent = widget.text;
            return p;
          case 'TextButton':
            const button = document.createElement('button');
            button.textContent = widget.text;
            button.onclick = () => handleButtonClick(widget.onClick.action);
            return button;
          case 'TextInput':
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = widget.label;
            return input;
          // Add more widget types as needed
        }
      }

      function handleButtonClick(action) {
        google.script.run.withSuccessHandler(showCard)[action.function]();
      }

      // Call onSidebarLoad when the page loads
      window.onload = onSidebarLoad;
    </script>
  </body>
</html>